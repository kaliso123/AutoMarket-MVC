@model AutoMarket.ViewModel.FilterCarsViewModel

@{
    ViewData["Title"] = "Filter Cars";
}

<h2>Filter Cars</h2>

@using (Html.BeginForm("FilterCars", "Cars", FormMethod.Get))
{
    <div>
        <label>Brand:</label>
        @Html.DropDownListFor(model => model.BrandId, new SelectList(Model.Brands, "Id", "BrandName"), "Select Brand")
    </div>

    <div>
        <label>Model:</label>
        @Html.DropDownListFor(model => model.ModelId, new SelectList(Model.Models, "Id", "ModelName"), "Select Model")
    </div>

    <div>
        <label>Fuel Type:</label>
        @Html.DropDownListFor(model => model.fuelType, new SelectList(Enum.GetValues(typeof(Models.Enums.FuelType))), "Select Fuel Type")
    </div>

    <div>
        <label>Color:</label>
        @Html.DropDownListFor(model => model.color, new SelectList(Enum.GetValues(typeof(Models.Enums.Color))), "Select Color")
    </div>

    <div>
        <label>Mileage:</label>
        @Html.DropDownListFor(model => model.mileage, new SelectList(Enum.GetValues(typeof(Models.Enums.Mileage))), "Select Mileage")
    </div>

    <div>
        <label>Seats:</label>
        @Html.DropDownListFor(model => model.seats, new SelectList(Enum.GetValues(typeof(Models.Enums.CarSeats))), "Select Seats")
    </div>

    <div>
        <label>Transmission Type:</label>
        @Html.DropDownListFor(model => model.transmissionType, new SelectList(Enum.GetValues(typeof(Models.Enums.TransmissionType))), "Select Transmission Type")
    </div>

    <div>
        <label>Start Date:</label>
        @Html.TextBoxFor(model => model.StartDate, new { type = "date" })
    </div>

    <div>
        <label>End Date:</label>
        @Html.TextBoxFor(model => model.EndDate, new { type = "date" })
    </div>
    <div>
        <label>Sort by Price:</label>
        @Html.DropDownListFor(model => model.SortByPrice, new SelectList(new[]
                {
    new { Value = "lowToHigh", Text = "Low to High" },
    new { Value = "highToLow", Text = "High to Low" }
    }, "Value", "Text"), "Select Sort Order")
    </div>
    <div>
        <label>Seats:</label>
        @Html.DropDownListFor(model => model.condition, new SelectList(Enum.GetValues(typeof(Models.Enums.Condition))), "Select Condition")
    </div>
    <div>
        <label>Price Range:</label>
        @Html.TextBoxFor(model => model.MinPrice, new { placeholder = "Min Price" })
        @Html.TextBoxFor(model => model.MaxPrice, new { placeholder = "Max Price" })
    </div>
    <button type="submit">Filter</button>
}

@if (Model.FilteredCars != null && Model.FilteredCars.Any())
{
    <h3>Filtered Cars</h3>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Brand</th>
                    <th>Model</th>
                    <th>Fuel Type</th>
                    <th>Color</th>
                    <th>Mileage</th>
                    <th>Transmission Type</th>
                    <th>Image</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var car in Model.FilteredCars)
                {
                    <tr>
                        <td>@car.CarBrand.BrandName</td>
                        <td>@car.CarModel.ModelName</td>
                        <td>@car.CarFuelType</td>
                        <td>@car.CarColor</td>
                        <td>@car.CarMileage</td>
                        <td>@car.CarTransmissionType</td>
                        <td>
                            @if (car.Photos != null && car.Photos.Any())
                            {
                                <img src="data:@(car.Photos.First().ContentType);base64,@(Convert.ToBase64String(car.Photos.First().PhotoData))" alt="Car Photo" class="thumbnail" style="max-height: 50px;" />
                            }
                            else
                            {
                                <span>No Photo</span>
                            }
                        </td>
                        <td>
                            <a href="@Url.Action("Details", "Cars", new { id = car.Id })" class="btn btn-info btn-sm">Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
